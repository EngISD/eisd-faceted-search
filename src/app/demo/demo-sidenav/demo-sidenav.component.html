<div class="container" [class.is-mobile]="mobileQuery.matches">
<!-- Bar containing filter icons, paginator and sort -->
  <div class="subnavbar">
  <!-- Filter icons -->
    <div class="filterIcons">
      <button class="filterButton" 
              mat-icon-button 
              (click)="snav.toggle(); snav1.close()">
        <mat-icon class="arrows" 
                  svgIcon="chevron-double-left" 
                  matListIcon        
                  *ngIf="sidenav.opened"></mat-icon>
        <mat-icon class="arrows" 
                  svgIcon="chevron-double-right" 
                  matListIcon 
                  *ngIf="!sidenav.opened"></mat-icon>
        <mat-icon class="filter1" 
                  svgIcon="filter-outline" 
                  matListIcon 
                  matTooltip="Chiudi sfaccettatura" 
                  *ngIf="sidenav.opened"></mat-icon>
        <mat-icon class="filter1" 
                  svgIcon="filter-outline" 
                  matListIcon 
                  matTooltip="Apri sfaccettatura" 
                  *ngIf="!sidenav.opened"></mat-icon>
      </button>
      <button class="filterButton" 
              mat-icon-button 
              (click)="resetAll()" >
          <mat-icon class="filter2" 
                    svgIcon="filter-outline" 
                    matListIcon 
                    matTooltip="Rimuovi filtri"></mat-icon>
          <mat-icon class="reset" 
                    svgIcon="close" 
                    matListIcon></mat-icon>
        </button>
    </div>
  <!-- Filter icons -->
  <!-- Paginator -->
    <div class="paginator">
      <mat-paginator #paginator
                     [length]="length"
                     [pageIndex]="pageIndex"
                     [pageSize]="pageSize"
                     [pageSizeOptions]="pageSizeOptions"
                     (page)="onPageChanged($event);">    
      </mat-paginator>
    </div>
  <!-- Paginator -->
  <!-- Sort -->
    <div class="sorting">
      <button mat-icon-button 
              class="sortButton" 
              (click)="sortResults()">
        <mat-icon svgIcon="arrow-collapse-up" 
                  *ngIf="descending"
                  matTooltip="Ascendente" 
                  class="sortIcon"></mat-icon>
        <mat-icon svgIcon="arrow-collapse-down" 
                  *ngIf="!descending"
                  matTooltip="Discendente" 
                  class="sortIcon"></mat-icon>
      </button>
      <mat-form-field class="no-line">
          <mat-select placeholder="Ordina per" 
                      panelClass="sortPanel"
                      [(ngModel)]="option">  
            <mat-option *ngFor="let option1 of options" 
                        (click)="sortAllResults()"
                        value="{{option1.id}}">{{option1.value}}</mat-option>
          </mat-select>
        </mat-form-field>
    </div>
    <div class="endSidenavOpen">
      <button  mat-icon-button 
              (click)="snav1.toggle()"
              *ngIf="sidenav1.opened"><mat-icon>toggle_on</mat-icon>
      </button>
    </div>
  <!-- Sort -->
  </div>
<!-- Bar containing filter icons, paginator and sort -->
<!-- Container -->
  <mat-sidenav-container class="sidenav-container"
                         [style.marginTop.px]="mobileQuery.matches ? 0 : 0">
  <!-- Sidenav -->
    <mat-sidenav #snav [opened]="mobileQuery.matches ? 'false' : 'true'" 
                 [mode]="mobileQuery.matches ? 'over' : 'side'"
                 [fixedInViewport]="mobileQuery.matches" 
                 [fixedTopGap]="mobileQuery.matches ? 97 : 97">
      <mat-nav-list class="facet">
        <mat-expansion-panel [expanded]="i &lt; 2" 
                             *ngFor="let category of categories; trackBy: trackByFn; let i = index">
          <mat-expansion-panel-header>
            <mat-panel-title class="noSelect">
              <mat-icon class="catIcon" style="font-size: 27px !important" 
                        matListIcon *ngIf="category.id != 'cdc'">{{ category.icon }}</mat-icon>
                        <img src="../../../assets/sitemap.png" alt="icon" width="27px" height="27px" *ngIf="category.id == 'cdc'">
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="categoryTitle" *ngIf="category.id != 'rcdc' && category.id != 'cp' && category.id != 'fun'">{{ category.value }}</span>
                        <span class="categoryTitleLong" *ngIf="category.id == 'rcdc' || category.id == 'cp' || category.id == 'fun'">{{ category.value }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <ng-template matExpansionPanelContent *ngIf="category.id != 'anno'">
            <mat-selection-list dense>
              <mat-list-option *ngFor="let checkbox of checkboxes[category.id]; trackBy: trackByFn;"
                               (click)="select(checkbox.code, category.id); onNgModelChange();"
                               [selected]="selectedFilters[category.id].includes(checkbox.code)"
                               [value]="checkbox.code">
                <mat-icon matListIcon *ngIf="category.id != 't8' && category.id != 'l136'">keyboard_arrow_right</mat-icon>
                <mat-icon matListIcon *ngIf="category.id == 't8' && checkbox.descr == 'N'">close</mat-icon>
                <mat-icon matListIcon *ngIf="category.id == 't8' && checkbox.descr == 'S'">check</mat-icon>
                <mat-icon matListIcon *ngIf="category.id == 'l136' && checkbox.descr == '1'">close</mat-icon>
                <mat-icon matListIcon *ngIf="category.id == 'l136' && checkbox.descr == '2'">check</mat-icon>
                <mat-icon matListIcon *ngIf="category.id == 'l136' && checkbox.descr == '3'">timer</mat-icon>
                <mat-icon matListIcon *ngIf="category.id == 'l136' && checkbox.descr == '4'">priority_high</mat-icon>
                  <p class="noSelect">{{ checkbox.descr }} ({{ checkbox.count }})</p>
              </mat-list-option>
              <button mat-raised-button class="moreButton"
                      *ngIf="hasMore[category.id]"         
                      (click)="showMore(category.id)">Mostra di pi√π</button>
              <button mat-raised-button class="moreButton" 
                      *ngIf="numMore[category.id] > 1" 
                      (click)="showLess(category.id)">Mostra meno</button>
            </mat-selection-list>
              </ng-template>
          <ng-template matExpansionPanelContent *ngIf="category.id == 'anno'">
            <canvas baseChart *ngIf="barChartData[0].data.length > 0"
                    [datasets]="barChartData"
                    [labels]="barChartLabels"
                    [options]="barChartOptions"
                    [legend]="barChartLegend"
                    [colors]="barChartColors"
                    [chartType]="barChartType"
                    (chartClick)="chartClicked($event)"></canvas>
          </ng-template>
        </mat-expansion-panel>
      </mat-nav-list>
    </mat-sidenav>
  <!-- Sidenav -->
  <!-- Content -->
    <mat-sidenav-content>
      <ngx-loading [show]="loading" 
                   [config]="{animationType: ngxLoadingAnimationTypes.circle, primaryColour: primaryColour, secondaryColour: secondaryColour, backdropBorderRadius: '3px'}">
      </ngx-loading>
      <cdk-virtual-scroll-viewport [itemSize]="137.5" 
                                   class="viewport">
        <div *cdkVirtualFor="let item of activePageDataChunk" 
              class="viewport-item mat-elevation-z1"
              (click) = "openSidenav(item); snav1.open(); snav.close()"
              cdkVirtualForTrackBy= 'trakByFn()'>
          <div class="round mat-elevation-z4"
               [ngClass]="{'hideOnSmall': mobileQuery.matches}">{{ item.comCodice | slice:0:3 }}</div>
          <div class="feature"
               [ngClass]="{'hideOnSmall': mobileQuery.matches}">
            <mat-icon svgIcon="feature-search-outline" matListIcon></mat-icon>
          </div>
          <div class="viewport-item-title">
            <div class="title" 
                 [ngClass]="{'smallerStatus': sidenav.opened}">
              <div class="infoFirst">
                <span class="code">{{ item.comCodice }}</span> {{item.comDescrizione}}</div>
              <div class="info">
                <div class="infoIcon"><mat-icon>account_box</mat-icon></div>
                <span class="code">{{ item.cliId }}</span>{{ item.comCliente }} 
              </div>
              <br>
              <div class="info">
                  <div class="infoIcon">
                    <img class="cdcIcon" src="../../../assets/sitemap.png" alt="icon" width="22px" height="22px"></div>
                    <!-- <mat-icon>euro_symbol</mat-icon> -->
                  <span class="code">{{item.cdcCodice}}</span>{{item.cdcDescrizione}}, {{item.cdcBusinessUnit}}
                </div>
              <br>
              <div class="info">
                <div class="infoIcon"><mat-icon>visibility</mat-icon></div>
                <span class="code">{{ item.cdcResponsabile }}</span>{{ item.respCognome }} {{ item.respNome }}
              </div>
              <div class="info">
              <div class="infoIcon">
                <mat-icon class="statusIconC" 
                          *ngIf="item.comStato=='C'"
                          [ngClass]="{'smallIcons': mobileQuery.matches}">assignment_turned_in
                </mat-icon>
                <mat-icon class="statusIconA" 
                          *ngIf="item.comStato=='A'"
                          [ngClass]="{'smallIcons': mobileQuery.matches}">assignment
                </mat-icon>
                <mat-icon class="statusIconS" 
                          *ngIf="item.comStato=='S'"
                          [ngClass]="{'smallIcons': mobileQuery.matches}">assignment_returned
                </mat-icon>
                <mat-icon class="statusIconI" 
                          *ngIf="item.comStato=='I'"
                          [ngClass]="{'smallIcons': mobileQuery.matches}">assignment_late
                </mat-icon>
                <div class="yearIcon">
                  <mat-icon [ngClass]="{'smallIcons': mobileQuery.matches}">
                    date_range
                  </mat-icon>
                  <div class="iconText"
                           [ngClass]="{'smallIcons': mobileQuery.matches}">{{item.anno}}
                  </div>
                </div>
                <div [ngClass]="{'goodStatus': ((item.ricaviC12-item.costiC12) &gt; 0), 'badStatus': ((item.costiC12-item.ricaviC12) &gt; 0), 'neutralStatus': (item.costiC12==item.ricaviC12)}">
                  <mat-icon class="bigcrIcon"
                            [ngClass]="{'smallIcons': mobileQuery.matches}">
                    euro_symbol
                  </mat-icon>
                  <mat-icon class="crIcon"
                            [ngClass]="{'smallIcons': mobileQuery.matches}">
                    remove
                  </mat-icon>
                  <div class="iconText"
                       [ngClass]="{'smallIcons': mobileQuery.matches}">{{item.costiC12 | number:'1.0-0'}}
                  </div>
                  <mat-icon class="bigcrIcon"
                            [ngClass]="{'smallIcons': mobileQuery.matches}">
                      euro_symbol
                  </mat-icon>
                  <mat-icon class="crIcon"
                            [ngClass]="{'smallIcons': mobileQuery.matches}">
                      add
                  </mat-icon>
                  <div class="iconText"
                       [ngClass]="{'smallIcons': mobileQuery.matches}">{{item.ricaviC12 | number:'1.0-0'}}
                  </div>
                </div>
              </div>

              </div> 
            </div>
          </div>
        </div>
      </cdk-virtual-scroll-viewport>
    </mat-sidenav-content>

    <mat-sidenav class="endSidenav" #snav1 [opened]="false" 
              [mode]="mobileQuery.matches ? 'over' : 'side'"
              [fixedInViewport]="mobileQuery.matches" 
              [fixedTopGap]="mobileQuery.matches ? 97 : 97"
              [position]="'end'">
      <app-dialog></app-dialog>
    </mat-sidenav>
 
  <!-- Content -->
  </mat-sidenav-container>
<!-- Container -->
</div>