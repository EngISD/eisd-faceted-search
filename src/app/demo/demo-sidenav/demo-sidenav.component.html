<div class="container" [class.is-mobile]="mobileQuery.matches">
<!-- Bar containing filter icons, paginator and sort -->
  <div class="subnavbar">
  <!-- Filter icons -->
    <div class="filterIcons">
      <button class="filterButton" 
              mat-icon-button 
              (click)="snav.toggle()">
        <mat-icon class="arrows" 
                  svgIcon="chevron-double-left" 
                  matListIcon        
                  *ngIf="sidenav.opened"></mat-icon>
        <mat-icon class="arrows" 
                  svgIcon="chevron-double-right" 
                  matListIcon 
                  *ngIf="!sidenav.opened"></mat-icon>
        <mat-icon class="filter1" 
                  svgIcon="filter-outline" 
                  matListIcon 
                  matTooltip="Chiudi sfaccettatura" 
                  *ngIf="sidenav.opened"></mat-icon>
        <mat-icon class="filter1" 
                  svgIcon="filter-outline" 
                  matListIcon 
                  matTooltip="Apri sfaccettatura" 
                  *ngIf="!sidenav.opened"></mat-icon>
      </button>
      <button class="filterButton" 
              mat-icon-button 
              (click)="resetAll()" >
          <mat-icon class="filter2" 
                    svgIcon="filter-outline" 
                    matListIcon 
                    matTooltip="Rimuovi filtri"></mat-icon>
          <mat-icon class="reset" 
                    svgIcon="close" 
                    matListIcon></mat-icon>
        </button>
    </div>
  <!-- Filter icons -->
  <!-- Paginator -->
    <div class="paginator">
      <mat-paginator #paginator
                     [length]="length"
                     [pageIndex]="pageIndex"
                     [pageSize]="pageSize"
                     [pageSizeOptions]="pageSizeOptions"
                     (page)="onPageChanged($event);">    
      </mat-paginator>
    </div>
  <!-- Paginator -->
  <!-- Sort -->
    <div class="sorting">
      <button mat-icon-button 
              class="sortButton" 
              (click)="sortResults()">
        <mat-icon svgIcon="arrow-collapse-up" 
                  *ngIf="descending" 
                  matTooltip="Ascendente"
                  class="sortIcon"></mat-icon>
        <mat-icon svgIcon="arrow-collapse-down" 
                  *ngIf="!descending" 
                  matTooltip="Discendente"
                  class="sortIcon"></mat-icon>
      </button>
      <mat-form-field class="no-line">
          <mat-select placeholder="Ordina per" 
                      disableOptionCentering panelClass="sortPanel"
                      [(ngModel)]="option"
                      >  
            <mat-option *ngFor="let option1 of options" 
                        (click)="sortAllResults()"
                        value="{{option1.id}}">{{option1.value}}</mat-option>
          </mat-select>
        </mat-form-field>
    </div>
  <!-- Sort -->
  </div>
<!-- Bar containing filter icons, paginator and sort -->
<!-- Container -->
  <mat-sidenav-container class="sidenav-container"
                         [style.marginTop.px]="mobileQuery.matches ? 0 : 0">
  <!-- Sidenav -->
    <mat-sidenav #snav [opened]="mobileQuery.matches ? 'false' : 'true'" 
                 [mode]="mobileQuery.matches ? 'over' : 'side'"
                 [fixedInViewport]="mobileQuery.matches" 
                 [fixedTopGap]="mobileQuery.matches ? 97 : 97">
      <mat-nav-list class="facet">
        <mat-expansion-panel [expanded]="i < 2" 
                             *ngFor="let category of categories; trackBy: trackByFn; let i = index">
          <mat-expansion-panel-header>
            <mat-panel-title class="noSelect">
              <mat-icon class="catIcon" 
                        matListIcon>{{ category.icon }}</mat-icon>
                        &nbsp;&nbsp;&nbsp;&nbsp;{{ category.id | titlecase }}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <ng-template matExpansionPanelContent *ngIf="category.id != 'anno' && category.id != 'l136'">
            <mat-selection-list dense [(ngModel)]="selected1[category.id]" 
                                (selectionChange)="onNgModelChange(category.id)" 
                                [ngModelOptions]="{standalone: true}">
              <mat-list-option *ngFor="let checkbox of checkboxes[category.id]; trackBy: trackByFn;"
                               (click)="dud(checkbox.code, category.id)"
                               [value]="checkbox.code"
                               [selected]="!dud1[category.id].indexOf(checkbox.code)">
                <mat-icon matListIcon>keyboard_arrow_right</mat-icon>
                  <p class="noSelect">{{ checkbox.descr }} ({{ checkbox.count }})</p>
              </mat-list-option>
              <button mat-raised-button class="moreButton"
                      *ngIf="hasMore[category.id]"         
                      (click)="showMore(category.id)">Mostra di più</button>
              <button mat-raised-button class="moreButton" 
                      *ngIf="numMore[category.id] > 1" 
                      (click)="showLess(category.id)">Mostra meno</button>
            </mat-selection-list>
              </ng-template>
          <ng-template matExpansionPanelContent *ngIf="category.id == 'anno'">
            <canvas baseChart *ngIf="barChartData[0].data.length > 0"
                    [datasets]="barChartData"
                    [labels]="barChartLabels"
                    [options]="barChartOptions"
                    [legend]="barChartLegend"
                    [colors]="barChartColors"
                    [chartType]="barChartType"
                    (chartHover)="chartHovered($event)"
                    (chartClick)="chartClicked($event)"></canvas>
          </ng-template>
          <ng-template matExpansionPanelContent *ngIf="category.id == 'l136'">
            <div class="flex">
              <div class="row">
                <div class="one" [ngClass]="{'mat-elevation-z9': hover1, 'mat-elevation-z1': !hover1, 'clickedColour': clicked1, 'pointer': hover1}" (mouseenter)="hover1 = true" (mouseleave)="hover1 = false" (click)="clicked1 = !clicked1; onNgModelChange('l136')">
                  <mat-icon class="flagIcon" [ngClass]="{'colourChange': (hover1 || clicked1)}" svgIcon="numeric-1-box-outline"></mat-icon>
                  <div class="counter" [ngClass]="{'colourChange': hover1}">({{checkboxes['l136'][0].count}})</div>
                </div>
                <div class="two" [ngClass]="{'mat-elevation-z9': hover2, 'mat-elevation-z1': !hover2, 'clickedColour': clicked2, 'pointer': hover2}" (mouseenter)="hover2 = true" (mouseleave)="hover2 = false" (click)="clicked2 = !clicked2; onNgModelChange('l136')">
                  <mat-icon class="flagIcon" [ngClass]="{'colourChange': (hover2 || clicked2)}" svgIcon="numeric-2-box-outline"></mat-icon>
                  <div class="counter" [ngClass]="{'colourChange': hover2}">({{checkboxes['l136'][1].count}})</div>
                </div>
              </div>
              <div class="row">
                <div class="three" [ngClass]="{'mat-elevation-z9': hover3, 'mat-elevation-z1': !hover3, 'clickedColour': clicked3, 'pointer': hover3}" (mouseenter)="hover3 = true" (mouseleave)="hover3 = false" (click)="clicked3 = !clicked3; onNgModelChange('l136')">
                  <mat-icon class="flagIcon" [ngClass]="{'colourChange': (hover3 || clicked3)}" svgIcon="numeric-3-box-outline"></mat-icon>
                  <div class="counter" [ngClass]="{'colourChange': hover3}">({{checkboxes['l136'][2].count}})</div>
                </div>
                <div class="four" [ngClass]="{'mat-elevation-z9': hover4, 'mat-elevation-z1': !hover4, 'clickedColour': clicked4, 'pointer': hover4}" (mouseenter)="hover4 = true" (mouseleave)="hover4 = false" (click)="clicked4 = !clicked4; onNgModelChange('l136')">
                  <mat-icon class="flagIcon" [ngClass]="{'colourChange': (hover4 || clicked4)}" svgIcon="numeric-4-box-outline"></mat-icon>
                  <div class="counter" [ngClass]="{'colourChange': hover4}">({{checkboxes['l136'][3].count}})</div>
                </div>
              </div>
            </div>
          </ng-template>
        </mat-expansion-panel>
      </mat-nav-list>
    </mat-sidenav>
  <!-- Sidenav -->
  <!-- Content -->
    <mat-sidenav-content>
      <ngx-loading [show]="loading" 
                   [config]="{animationType: ngxLoadingAnimationTypes.circle, primaryColour: primaryColour, secondaryColour: secondaryColour, backdropBorderRadius: '3px'}">
      </ngx-loading>
      <cdk-virtual-scroll-viewport itemSize="20" 
                                   class="viewport">
        <div *cdkVirtualFor="let item of activePageDataChunk; let first = first;"  
              class="viewport-item mat-elevation-z1"
              [class.first] = "first"
              (click) = "openDialog(item)">
          <div class="round mat-elevation-z4"
               [ngClass]="{'hideOnSmall': sidenav.opened}">{{ item.comCodice | slice:0:3 }}</div>
          <div class="feature"
               [ngClass]="{'hideOnSmall': sidenav.opened}">
            <mat-icon svgIcon="feature-search-outline" matListIcon></mat-icon>
          </div>
          <div class="viewport-item-title">
            <div class="title" 
                 [ngClass]="{'smallerStatus': sidenav.opened}">
              <div class="infoFirst" 
                   [ngClass]="{'noWrap': sidenav.opened}">
                <span class="code">{{ item.comCodice }}</span>{{item.comDescrizione}} 
              </div>
              <div class="info">
                <span class="code">{{ item.cdcResponsabile }}</span>{{ item.respCognome }} {{ item.respNome }}
              </div>
              <div class="info">
                <span class="code">{{item.cdcCodice}}</span>{{item.cdcDescrizione}}, {{item.cdcBusinessUnit}}
              </div>
              <div class="info icons">
                <mat-icon class="statusIconC" 
                          svgIcon="clipboard-check" 
                          *ngIf="item.comStato=='C'">
                </mat-icon>
                <mat-icon class="statusIconA" 
                          svgIcon="clipboard-text" 
                          *ngIf="item.comStato=='A'"
                          registry.getDefaultFontSetClass>
                </mat-icon>
                <mat-icon class="statusIconS" 
                          svgIcon="clipboard-arrow-down" 
                          *ngIf="item.comStato=='S'">
                </mat-icon>
                <mat-icon class="statusIconI" 
                          svgIcon="clipboard-alert" 
                          *ngIf="item.comStato=='I'">
                </mat-icon>
                <div class="yearIcon">
                    <mat-icon class="statusIconA" 
                              svgIcon="calendar">
                    </mat-icon><div class="year">{{item.anno}}</div>
                </div>
                <mat-icon class="L136Icon" 
                          svgIcon="numeric-1-box-outline"
                          *ngIf="item.comLegge136=='1'"></mat-icon>
                <mat-icon class="L136Icon" 
                          svgIcon="numeric-2-box-outline"
                          *ngIf="item.comLegge136=='2'"></mat-icon>
                <mat-icon class="L136Icon" 
                          svgIcon="numeric-3-box-outline"
                          *ngIf="item.comLegge136=='3'"></mat-icon>
                <mat-icon class="L136Icon" 
                          svgIcon="numeric-4-box-outline"
                          *ngIf="item.comLegge136=='4'"></mat-icon>
              </div> 
            </div>
            <div class="statusInfo" [ngClass]="{'biggerStatus': sidenav.opened}">
              <div class="status"
                   [ngClass]="{'goodStatus': ((item.ricaviC12-item.costiC12) &gt; 0), 'badStatus': ((item.costiC12-item.ricaviC12) &gt; 0), 'neutralStatus': (item.costiC12==item.ricaviC12)}">
                <div class="costs">
                  <mat-icon class="minusIcon" svgIcon="minus"></mat-icon>
                  <div class="costValue"
                       [ngClass]="{'smallFont': sidenav.opened && !mobileQuery.matches}">
                      {{ item.costiC12 | number: '1.0' }} €
                  </div>
                </div>
                <br>
                <div class="costs">
                  <mat-icon class="plusIcon" svgIcon="plus"></mat-icon>
                  <div class="costValue"
                       [ngClass]="{'smallFont': sidenav.opened && !mobileQuery.matches}">
                      {{ item.ricaviC12 | number: '1.0' }} €
                  </div>
                </div> 
              </div>
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
      </cdk-virtual-scroll-viewport>
    </mat-sidenav-content>
  <!-- Content -->
  </mat-sidenav-container>
<!-- Container -->
</div>